(function(a){function b(a){a=a||{},this.maxRestart=a.maxRestart||0,this.maxTime=a.maxTime||0,this.delay=a.delay||function(){return 0},this.onerror=function(){},this.errors=[]}typeof exports!="undefined"&&(a=exports),b.prototype.run=function(a){this._run=a,this._start()},b.prototype._start=function(){var a=this,b=function(){a.errors.push(+(new Date)),a._restartOrError.apply(a,arguments)},c=Array.prototype.slice.call(arguments);this._run.apply(this,[b].concat(c))},b.prototype._restartOrError=function(){this._cleanup();if(this.maxRestart>=this.errors.length){var a=this,b=arguments;setTimeout(function(){a._start.apply(a,b)},this.delay(this.errors.length)*1e3)}else this.onerror.apply(this,arguments)},b.prototype._cleanup=function(){if(this.maxTime==0)return;var a=+(new Date),b=0;for(var c=0;c<this.errors.length;c++)if(a-this.errors[c]>this.maxTime)b++;else break;this.errors.splice(0,b)},a.Supervisor=b,a.callMe=function(a){function f(a){return function(b){return d.maxTime=a(b),e}}var c=function(){},d={maxRestart:0,maxTime:0,delay:null},e={onError:function(a){return c=a,this},max:function(a){return d.maxRestart=a,this},delay:function(a){return d.delay=a,this},run:function(){var e=new b(d);e.onerror=c,e.run(a)}};return e.seconds=f(function(a){return a*1e3}),e.minutes=f(function(a){return a*1e3*60}),e.hours=f(function(a){return a*1e3*3600}),e}})(this);